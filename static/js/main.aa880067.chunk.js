(this["webpackJsonpsound-wave-composer"]=this["webpackJsonpsound-wave-composer"]||[]).push([[0],[,,,,,,,,,,,,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"sine",(function(){return y})),n.d(i,"square",(function(){return x})),n.d(i,"sawtooth",(function(){return m})),n.d(i,"triangle",(function(){return w}));var a=n(1),c=n.n(a),r=n(10),o=n.n(r),s=(n(15),n(2)),u=n(4),f=(n(16),n(3)),l=(n(17),n(0));for(var h=function(t){var e=t.notes,n=t.draw,i=t.deleteNotes,c=Object(a.useState)(0),r=Object(s.a)(c,2),o=r[0],u=r[1],h=Object(a.useState)(0),v=Object(s.a)(h,2),j=v[0],b=v[1];return Object(a.useEffect)((function(){u(e[0].tuningOffset),b(e[0].getLength())}),[e]),Object(l.jsxs)("div",{className:"note-settings",children:["Tuning offset ",Object(l.jsx)("input",{value:o,onChange:function(t){var i=t.target.value;u(i);var a,c=Object(f.a)(e);try{for(c.s();!(a=c.n()).done;){a.value.setTuningOffset(Number(i))}}catch(r){c.e(r)}finally{c.f()}n()}})," cents.",Object(l.jsx)("br",{}),"Length ",Object(l.jsx)("input",{value:j,onChange:function(t){var i=t.target.value;b(i);var a,c=Object(f.a)(e);try{for(c.s();!(a=c.n()).done;){a.value.setLength(Number(i))}}catch(r){c.e(r)}finally{c.f()}n()}}),"beats.",Object(l.jsx)("br",{}),Object(l.jsx)("button",{onClick:i,children:"Delete"})]})},v=440,j=[v,v*Math.pow(2,1/12),v*Math.pow(2,2/12),v*Math.pow(2,.25),v*Math.pow(2,4/12),v*Math.pow(2,5/12),v*Math.pow(2,.5),v*Math.pow(2,7/12),v*Math.pow(2,8/12),v*Math.pow(2,.75),v*Math.pow(2,10/12),v*Math.pow(2,11/12)].reverse(),b=["A4","A\u266f4","B4","C5","C\u266f5","D5","D\u266f5","E5","F5","F\u266f5","G5","G\u266f5"].reverse(),O=44100,g=8191.75,d=80,p=20,y=function(t,e){return Math.sin(2*Math.PI*t*e)},x=function(t,e){return Math.sign(y(t,e))},m=function(t,e){return 2*(e*t-Math.floor(.5+e*t))},w=function(t,e){return 2*Math.abs(m(t,e))-1},M=["#0c0","#c00","#cc0","#00c"],k=Object.keys(i),N={},T=0;T<M.length;T++)N[k[T]]=M[T];var S=N,C=(n(19),b.length),B=C*p,L=400,A=B+16,D=function(t){return t.reduce((function(t,e){return Math.max(t,e.getBeatEnd())}),0)},E=function(t){return Math.min(L/((D(t)+2)*d),1)*L},R=function(t){return L-E(t)};var W=function(t){var e=t.notes,n=t.setNotes,i=t.beatDivision,c=t.makeNewNote,r=Object(a.useRef)(null),o=Object(a.useState)([]),v=Object(s.a)(o,2),j=v[0],O=v[1],g=Object(a.useState)(!1),y=Object(s.a)(g,2),x=y[0],m=y[1],w=Object(a.useState)(!1),M=Object(s.a)(w,2),k=M[0],N=M[1],T=Object(a.useState)(0),W=Object(s.a)(T,2),F=W[0],I=W[1],X=function(){var t=R(e);if(0===t)return 0;var n=F/t;return(D(e)-3)*n},G=function(){var t=r.current.getContext("2d");t.clearRect(0,0,400,A),U(t),P(t),q(t),J(t)},U=function(t){t.lineWidth=1,t.strokeStyle="#666",V(t),Y(t)},V=function(t){for(var e=1;e<=C;e++){var n=p*e+.5;t.beginPath(),t.moveTo(0,n),t.lineTo(L,n),t.stroke()}},Y=function(t){for(var e=X(),n=6*i,a=1;a<=n;a++){var c=e%1*i,r=d/i,o=Math.floor(r*(a-c))+.5;t.lineWidth=a%i===0?3:1,t.beginPath(),t.moveTo(o,0),t.lineTo(o,B),t.stroke()}},P=function(t){var n,i=X(),a=i+5,c=Object(f.a)(e);try{for(c.s();!(n=c.n()).done;){var r=n.value;if(r.inView(i,a)){var o=(r.getOffset()-i)*d,s=r.getY();t.fillStyle=S[r.func],t.fillRect(o+2,s+2,r.width-3,r.height-3),t.strokeStyle=j.includes(r)?"#900":"#666",t.lineWidth=2,t.strokeRect(o+2.5,s+2.5,r.width-4,r.height-4)}}}catch(u){c.e(u)}finally{c.f()}},q=function(t){t.font="16px sans-serif",t.fillStyle="#000";for(var e=0;e<C;e++)t.fillText(b[e],0,p*(e+1)-4)},J=function(t){var n=E(e);t.fillStyle="#999",t.fillRect(F,B,n,16)},K=function(t){O(x?[].concat(Object(u.a)(j),[t]):[t])},z=function(t){var e=t.target.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}};return Object(a.useEffect)((function(){return G()})),Object(l.jsxs)("div",{className:"canvas",children:[Object(l.jsxs)("div",{className:"canvas-wrapper",children:[Object(l.jsx)("canvas",{ref:r,width:400,height:A,tabIndex:"0",onClick:function(t){var n=z(t);if(!(n.y>=B)){var a,r=X()*d,o=Object(f.a)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.inRect(n.x+r,n.y))return K(s),void G()}}catch(g){o.e(g)}finally{o.f()}var l=d/i,h=Math.floor((n.x+r)/l)*l,v=Math.floor(n.y/p)*p,j=F/E(e),b=c(h,v);O([]),I(j*E([].concat(Object(u.a)(e),[b]))),G()}},onKeyDown:function(t){"Control"===t.key&&m(!0)},onKeyUp:function(t){"Control"===t.key&&m(!1)},onMouseDown:function(t){z(t).y>=B&&N(!0)},onMouseMove:function(t){if(k){var n=F+t.movementX;n=Math.max(n,0),n=Math.min(n,R(e)),I(n)}},onMouseUp:function(t){N(!1)}}),Object(l.jsx)("button",{onClick:function(){n([]),O([]),I(0),G()},children:"Clear"})]}),j.length>0&&Object(l.jsx)(h,{notes:j,draw:G,deleteNotes:function(){var t=e.filter((function(t){return!j.includes(t)}));n(Object(u.a)(t)),O([]),I(Math.min(F,R(t)))}})]})};n(20);var F=function(t){var e=t.setNewNoteLength,n=t.setBeatDivision,c=t.setTempo,r=t.setWaveFunction,o=Object(a.useState)(1),u=Object(s.a)(o,2),f=u[0],h=u[1],v=Object(a.useState)(4),j=Object(s.a)(v,2),b=j[0],O=j[1],g=Object(a.useState)(60),d=Object(s.a)(g,2),p=d[0],y=d[1],x=Object(a.useState)("sine"),m=Object(s.a)(x,2),w=m[0],M=m[1];return Object(l.jsxs)("div",{className:"display-settings",children:["New note length ",Object(l.jsx)("input",{value:f,onChange:function(t){var n=t.target.value;h(n),e(n)}}),"beats.",Object(l.jsx)("br",{}),"Beat division ",Object(l.jsx)("input",{value:b,onChange:function(t){var e=t.target.value;O(e),n(e)}}),".",Object(l.jsx)("br",{}),"Tempo ",Object(l.jsx)("input",{value:p,onChange:function(t){var e=t.target.value;y(e),c(e)}}),"bpm.",Object(l.jsx)("br",{}),"Wave ",Object(l.jsx)("select",{value:w,onChange:function(t){var e=t.target.value;M(e),r(e)},children:Object.keys(i).map((function(t){return Object(l.jsx)("option",{value:t,children:t},t)}))})]})},I=n(6),X=n(7),G=function(){function t(e,n,i,a){Object(I.a)(this,t),this.x=e,this.y=n,this.width=d*i,this.height=p,this.tuningOffset=0,this.length=i,this.func=a}return Object(X.a)(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y-this.tuningOffset/100*p}},{key:"getOffset",value:function(){return this.x/d}},{key:"getTone",value:function(){return j[this.y/p]*Math.pow(2,this.tuningOffset/1200)}},{key:"getLength",value:function(){return this.length}},{key:"getBeatEnd",value:function(){return this.getOffset()+this.getLength()}},{key:"getType",value:function(){return this.func}},{key:"setLength",value:function(t){this.length=t,this.width=d*t}},{key:"setTuningOffset",value:function(t){this.tuningOffset=t}},{key:"inRect",value:function(t,e){return t>=this.getX()&&t<=this.getX()+this.width&&e>=this.getY()&&e<=this.getY()+this.height}},{key:"inView",value:function(t,e){return this.getOffset()<e||this.getBeatEnd()>t}}]),t}();var U=function(t){var e=t.notes,n=t.setNotes,i=t.setTempo,c=Object(a.useState)(1),r=Object(s.a)(c,2),o=r[0],f=r[1],h=Object(a.useState)(4),v=Object(s.a)(h,2),j=v[0],b=v[1],O=Object(a.useState)("sine"),g=Object(s.a)(O,2),d=g[0],p=g[1];return Object(l.jsxs)("div",{className:"display",children:[Object(l.jsx)(F,{setNewNoteLength:function(t){f(t)},setBeatDivision:function(t){b(t)},setTempo:function(t){i(t)},setWaveFunction:function(t){p(t)}}),Object(l.jsx)(W,{notes:e,setNotes:n,beatDivision:j,makeNewNote:function(t,i){var a=new G(t,i,Number(o),d),c=[].concat(Object(u.a)(e),[a]);return n(Object(u.a)(c)),a}})]})};n(21);var V=function(t,e,n){for(var i=[],a=0;a<O*e;a++){var c=Math.floor(n(t,a/O)*g);i.push(c,c)}return i};function Y(t,e){for(var n=new Array(e).fill(0),i=0;i<e;i++){var a=t>>8*i&255;n[i]=a}return n.reverse(),n}function P(t){return t.split("").map((function(t){return t.charCodeAt(0)}))}function q(t,e){var n,i=Object(f.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;t.push(a)}}catch(c){i.e(c)}finally{i.f()}}function J(t,e){for(var n=e.length-1;n>=0;n--)t.push(e[n])}var K=function(t,e){var n=[];!function(t,e){q(t,P("RIFF")),J(t,Y(36+e,4)),q(t,P("WAVE")),q(t,P("fmt ")),J(t,Y(16,4)),J(t,Y(1,2)),J(t,Y(2,2)),J(t,Y(O,4)),J(t,Y(176400,4)),J(t,Y(4,2)),J(t,Y(16,2)),q(t,P("data")),J(t,Y(e,4))}(n,e),function(t,e){var n,i=Object(f.a)(e);try{for(i.s();!(n=i.n()).done;)J(t,Y(n.value,2))}catch(a){i.e(a)}finally{i.f()}}(n,t);var i=new Uint8Array(n),a=new Blob([i],{type:"application/octet-stream"});return window.URL.createObjectURL(a)};var z=function(t){var e=t.notes,n=t.tempo,c=Object(a.useState)(null),r=Object(s.a)(c,2),o=r[0],u=r[1],h=function(t){var e=t.reduce((function(t,e){return Math.max(t,e)}),0);return e>g?t.map((function(t){return Math.floor(t*(g/e))})):t};return Object(l.jsxs)("div",{className:"generator",children:[Object(l.jsx)("button",{onClick:function(){var t=e.reduce((function(t,e){return Math.max(t,e.getBeatEnd())}),0)/(n/60),a=Math.ceil(176400*t);u(0),setTimeout((function(){var t,c=new Array(a).fill(0),r=Object(f.a)(e);try{for(r.s();!(t=r.n()).done;)for(var o=t.value,s=o.getOffset()/(n/60),l=V(o.getTone(),o.getLength()/(n/60),i[o.func]),v=0;v<l.length;v++){c[Math.floor(88200*s)+v]+=l[v]}}catch(b){r.e(b)}finally{r.f()}var j=h(c);u(K(j,a))}),0)},children:"Generate!"}),o?Object(l.jsx)("audio",{src:o,controls:!0}):0===o?Object(l.jsx)("div",{children:"Generating..."}):void 0]})},H=function(){function t(e,n,i,a,c){Object(I.a)(this,t),this.osc=a.createOscillator(),this.osc.type=e,this.osc.frequency.setValueAtTime(n,a.currentTime),this.osc.connect(c),this.osc.start(),this.osc.stop(a.currentTime+i/1e3)}return Object(X.a)(t,[{key:"stop",value:function(){this.osc.stop()}}]),t}(),Q=function(){function t(){Object(I.a)(this,t),this.ctx=new(window.AudioContext||window.webkitAudioContext),this.volume=this.ctx.createGain(),this.volume.connect(this.ctx.destination),this.volume.gain.setValueAtTime(.25,this.ctx.currentTime),this.oscillators=[],this.interval=null}return Object(X.a)(t,[{key:"start",value:function(t,e){var n=this;this.stop();var i=6e4/(e*d),a=Object(u.a)(t).sort((function(t,e){return t.getOffset()-e.getOffset()})),c=0,r=a.reduce((function(t,e){return Math.max(t,e.getBeatEnd())}),0)*d,o=new Date;this.interval=setInterval((function(){for(var t=(new Date-o)/i;c<a.length&&a[c].getX()<=t;){var e=a[c],s=e.getLength()*d*i;n.oscillators.push(new H(e.getType(),e.getTone(),s,n.ctx,n.volume)),c++}t>=r&&n.stop()}),i)}},{key:"stop",value:function(){this.oscillators.forEach((function(t){return t.stop()})),this.oscillators=[],clearInterval(this.interval)}}]),t}();var Z=function(){var t=Object(a.useState)([]),e=Object(s.a)(t,2),n=e[0],i=e[1],c=Object(a.useState)(60),r=Object(s.a)(c,2),o=r[0],u=r[1],f=new Q;return Object(l.jsxs)("div",{children:[Object(l.jsx)(U,{notes:n,setNotes:i,tempo:o,setTempo:u}),Object(l.jsx)(z,{notes:n,tempo:o}),Object(l.jsx)("button",{onClick:function(){f.start(n,o)},children:"Play"})]})};n(22);var $=function(){return Object(l.jsx)("div",{className:"app",children:Object(l.jsx)(Z,{})})};o.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)($,{})}),document.getElementById("root"))}],[[23,1,2]]]);
//# sourceMappingURL=main.aa880067.chunk.js.map